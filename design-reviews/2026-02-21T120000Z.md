---
type: design-review
timestamp: 2026-02-21T12:00:00Z
components: [craftec-ecosystem, craftnet, craftobj, settlement, prover, aggregator, craftstudio, craftec-core]
verdicts: [DEVIATIONS_FOUND, PASS_WITH_NOTES, PASS_WITH_NOTES, DEVIATIONS_FOUND, PASS, DEVIATIONS_FOUND, DEVIATIONS_FOUND, DEVIATIONS_FOUND]
tags: [design-review, full-audit, all-crafts, ecosystem, craftnet, craftobj, settlement, prover, aggregator, craftstudio, identity, ipc, agent-runtime]
---

# Design Review Session: 2026-02-21T12:00:00Z

**Context**: Full ecosystem audit ‚Äî all design docs in `docs/` vs actual implementation across all repos.

---

## Craftec Ecosystem (`docs/CRAFTEC_ECOSYSTEM.md`)
**Timestamp**: 2026-02-21T12:00:00Z
**Design doc**: `docs/CRAFTEC_ECOSYSTEM.md`
**Trigger**: full audit
**Verdict**: DEVIATIONS_FOUND

### Findings

‚úÖ MATCHES:
- craftec-core shared foundation concept
- Dependency rule (crafts depend only on craftec-core)
- Shared tech stack (Rust, Tokio, libp2p, dalek, Solana)

‚ö†Ô∏è DEVIATIONS:
- Spec says `computecraft/` ‚Äî actual is `craftcom/`
- Spec says `parallelcraft/` ‚Äî removed/replaced by `craftgpu/`
- Root CLAUDE.md says `datacraft/` ‚Äî actual is `craftobj/`
- Spec says craftec-core has 13 crates ‚Äî actual: 16 (adds aggregator, agent-runtime, distribution-guest)

‚ùå MISSING:
- Identity: social recovery, M-of-N guardians, key rotation (only DID + reputation stubs)
- IPC: WebSocket transport (Unix socket only at audit time)
- 9 repos not in ecosystem doc: craftsql, craftvfs, craftsec, craftcom, cloakcraft, flowcraft, handcraft, scalecraft, worldcraft

### Disposition
- ‚ö†Ô∏è Naming mismatches: **SPEC UPDATE NEEDED** ‚Äî update ecosystem doc + root CLAUDE.md to reflect actual repo names
- ‚ùå Identity features: **FIX NEEDED** ‚Äî social recovery, key rotation, cross-craft reputation not implemented
- ‚ùå IPC WebSocket: ~~**FIX NEEDED**~~ ‚Üí **DONE** (2026-02-21T18:30:00Z, IPC unification plan)
- ‚ùå Missing repos in doc: **SPEC UPDATE NEEDED** ‚Äî add all repos to ecosystem doc

---

## CraftNet (`docs/CRAFTNET_DESIGN.md`)
**Timestamp**: 2026-02-21T12:00:00Z
**Design doc**: `docs/CRAFTNET_DESIGN.md`
**Trigger**: full audit
**Verdict**: PASS_WITH_NOTES

### Findings

‚úÖ MATCHES:
- Onion routing with X25519-ECDH + ChaCha20-Poly1305 per-layer
- Erasure coding (Reed-Solomon 5/3, 3KB chunks)
- ForwardReceipt with ed25519 signatures
- Trustless relay verification via encrypted routing tags
- SOCKS5 proxy (TCP tunnel mode)
- HopMode: Direct/Single/Double/Triple/Quad
- Subscription tier enforcement
- Multi-hop path building with RequestBuilder
- Exit node HTTP + TCP tunnel handlers
- Aggregator with append-only history ledger
- Comprehensive test suite

‚ö†Ô∏è DEVIATIONS:
- Aggregator should be CraftCOM WASM agent (per AGGREGATOR_DESIGN) ‚Äî impl is native Rust crate
- IPC should support WebSocket for CraftStudio ‚Äî daemon only had Unix socket at audit time

‚ùå MISSING:
- DNS-level blocking at exit (ExitConfig has blocked_domains but no DNS integration)
- DNS rebinding protection (only basic IP range SSRF checks)
- Mobile TUN interface (uniffi crate exists but incomplete)

### Disposition
- ‚ö†Ô∏è Aggregator architecture: **DECISION NEEDED** ‚Äî native Rust works, CraftCOM agent is aspirational
- ‚ö†Ô∏è IPC WebSocket: ~~**FIX NEEDED**~~ ‚Üí **DONE** (adopted craftec-ipc shared IpcHandler)
- ‚ùå DNS blocking/rebinding: **FIX NEEDED** ‚Äî security gap at exit nodes
- ‚ùå Mobile TUN: **FIX NEEDED** ‚Äî uniffi incomplete, iOS Network Extension not wired

---

## CraftOBJ (`docs/CRAFTOBJ_DESIGN.md`)
**Timestamp**: 2026-02-21T12:00:00Z
**Design doc**: `docs/CRAFTOBJ_DESIGN.md`
**Trigger**: full audit
**Verdict**: PASS_WITH_NOTES

### Findings

‚úÖ MATCHES:
- Content-addressed storage with ContentId (SHA-256)
- RLNC erasure coding over GF(2^8) with coefficient vectors
- Self-describing pieces (PieceHeader)
- PDP via GF(2^8) cross-checking
- Health scanning + rotational repair
- Demand-driven scaling
- Persistent streams (Bitswap-style)
- PEX, capability-based peer selection
- Storage receipts for settlement
- DHT-based content routing
- 24K lines, 166+ tests

‚ö†Ô∏è DEVIATIONS:
- Aggregator is native library, not CraftCOM WASM agent reading from CraftSQL
- Receipts delivered via P2P gossipsub, not CraftSQL
- SEGMENT_SIZE hardcoded to 10 MB (spec says configurable)

### Disposition
- ‚ö†Ô∏è Aggregator architecture: **DECISION NEEDED** ‚Äî same as CraftNet, native P2P works
- ‚ö†Ô∏è Receipt delivery: **DECISION NEEDED** ‚Äî P2P gossipsub vs CraftSQL
- ‚ö†Ô∏è Segment size: **LOW** ‚Äî hardcoded is fine for now

---

## Settlement (`docs/SETTLEMENT_DESIGN.md` + `docs/SETTLEMENT_PROGRAM_DESIGN.md`)
**Timestamp**: 2026-02-21T12:00:00Z
**Design doc**: `docs/SETTLEMENT_DESIGN.md`, `docs/SETTLEMENT_PROGRAM_DESIGN.md`
**Trigger**: full audit
**Verdict**: DEVIATIONS_FOUND

### Findings

‚úÖ MATCHES:
- ServiceType enum (Tunnel=0, Data=1, Compute=2, Parallel=3, Bundle=4)
- CreatorPool, SubscriptionPool, PaymentChannel account types
- PDA derivation (config, treasury, pool, creator_pool, payment_channel, claim_receipt)
- 13 instruction builders
- StorageTier enum, StorageReceipt implementing ContributionReceipt

‚ö†Ô∏è DEVIATIONS:
- `update_config` instruction missing from SDK builders
- `deposit` (fan funding) named `fund_creator_pool` in impl
- `force_close` (unilateral payment channel close) missing ‚Äî only cooperative close exists

‚ùå MISSING:
- PricingPlan account type with billing periods
- `create_plan`, `update_plan`, `delete_plan` instructions
- Light Protocol integration for double-claim prevention (partial ‚Äî types in CraftNet only)

### Disposition
- ‚ö†Ô∏è `update_config` missing: **FIX NEEDED**
- ‚ö†Ô∏è `force_close` missing: **FIX NEEDED**
- ‚ùå PricingPlan system: **FIX NEEDED** ‚Äî admin-managed tiers with billing periods
- ‚ùå Light Protocol: **FIX NEEDED** ‚Äî move from CraftNet to core SDK

---

## Prover (`docs/PROVER_DESIGN.md`)
**Timestamp**: 2026-02-21T12:00:00Z
**Design doc**: `docs/PROVER_DESIGN.md`
**Trigger**: full audit
**Verdict**: PASS

### Findings

‚úÖ MATCHES:
- Dual-mode: Mock (default) and SP1 (feature flag)
- Guest program: sort ‚Üí weights ‚Üí SHA-256 Merkle tree ‚Üí root
- DistributionInput/DistributionOutput types
- Host-side receipt pre-aggregation
- BatchProof structure

üÜï EXTRA:
- Guest intentionally skips ed25519 verification (documented design decision)

### Disposition
- All good. ~95% complete.

---

## Aggregator (`docs/AGGREGATOR_DESIGN.md`)
**Timestamp**: 2026-02-21T12:00:00Z
**Design doc**: `docs/AGGREGATOR_DESIGN.md`
**Trigger**: full audit
**Verdict**: DEVIATIONS_FOUND

### Findings

‚ö†Ô∏è DEVIATIONS:
- Spec says CraftCOM WASM agent ‚Äî impl is native Rust library
- Spec says receipts from CraftSQL ‚Äî impl uses P2P gossipsub
- Spec says SQL persistence for crash recovery ‚Äî impl uses in-memory (core) / JSON file (CraftNet)

### Disposition
- ‚ö†Ô∏è Architecture mismatch: **DECISION NEEDED** ‚Äî current P2P approach works; CraftCOM/CraftSQL approach requires those systems to be production-ready. Update design doc to match chosen direction.

---

## CraftStudio (`docs/CRAFTSTUDIO_DESIGN.md`)
**Timestamp**: 2026-02-21T12:00:00Z
**Design doc**: `docs/CRAFTSTUDIO_DESIGN.md`
**Trigger**: full audit
**Verdict**: DEVIATIONS_FOUND

### Findings

‚úÖ MATCHES:
- Tauri v2 project structure
- React frontend scaffolded

‚ùå MISSING (at audit time):
- `craftstudio-daemon` with libp2p + multi-protocol
- WebSocket JSON-RPC server
- CraftNet integration (tunnel.connect, etc.)
- CraftOBJ integration (data.publish, etc.)
- Identity management UI
- Settlement/wallet UI

### Disposition
- ‚ùå IPC + tunnel + data integration: ~~**FIX NEEDED**~~ ‚Üí **DONE** (2026-02-21T18:30:00Z, IPC unification)
- ‚ùå Identity UI: **FIX NEEDED**
- ‚ùå Settlement/wallet UI: **FIX NEEDED**

---

## craftec-core Internal
**Timestamp**: 2026-02-21T12:00:00Z
**Design doc**: `docs/CRAFTEC_ECOSYSTEM.md`
**Trigger**: full audit
**Verdict**: DEVIATIONS_FOUND

### Findings

‚úÖ craftec-identity: DID + DID Document ‚úÖ
‚úÖ craftec-ipc: JSON-RPC server + client (Unix socket) ‚úÖ
‚úÖ craftec-network: Full libp2p stack (Kademlia, gossipsub, relay, mDNS, PEX, stream) ‚úÖ

‚ùå MISSING:
- craftec-identity: reputation computation, social recovery, key rotation, cross-craft reputation, profiles
- craftec-ipc: WebSocket server, server-sent notifications
- craftec-agent-runtime: WASM sandbox scaffolded but not functional

### Disposition
- ‚ùå Identity features: **FIX NEEDED** ‚Äî social recovery, key rotation, reputation
- ‚ùå IPC WebSocket: ~~**FIX NEEDED**~~ ‚Üí **DONE** (2026-02-21T18:30:00Z)
- ‚ùå Agent runtime: **FIX NEEDED** ‚Äî prerequisite for CraftCOM aggregator architecture

---

## Repos with No Design Doc
**Timestamp**: 2026-02-21T12:00:00Z

| Repo | Needs Design Doc? |
|------|-------------------|
| `craftsec/` | ‚úÖ YES |
| `craftsql/` | ‚úÖ YES |
| `craftvfs/` | ‚úÖ YES |
| `craftcom/` | ‚úÖ YES |
| `scalecraft/` | ‚úÖ YES |
| `cloakcraft/` | ‚ö†Ô∏è MAYBE (deployed) |
| `flowcraft/` | ‚ö†Ô∏è MAYBE (deployed) |
| `handcraft/` | ‚ö†Ô∏è MAYBE (deployed) |
| `worldcraft/` | No (game) |

### Disposition
- 5 repos need design docs: **SPEC UPDATE NEEDED**
